{
    # Optional: email for ACME/Let's Encrypt
    email {$CADDY_EMAIL}
    # Enable debugging if needed
    # debug
}

{$DOMAIN} {
    encode gzip zstd
    log {
        output stdout
        format console
        level INFO
    }

    # Serve the management dashboard (Flask) at root
    @dashboard {
        path /*
        not path /api*
    }
    reverse_proxy @dashboard paincare_management:5000

    # Proxy API under /api/* to FastAPI service
    handle_path /api/* {
        reverse_proxy paincare_api:8000
    }

    # Basic CORS for API responses via header injection (optional, FastAPI also enables CORS)
    header /* {
        Access-Control-Allow-Origin *
        Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
        Access-Control-Allow-Headers "*"
    }
}
